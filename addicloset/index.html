<!doctype html>
<html>

<div id="main">
  <script>
    // Setup
    const svgns = "http://www.w3.org/2000/svg"
    const main = document.getElementById("main")
    let velocity = 0
    let prevX = 0
    
    const canvas = document.createElementNS(svgns, "svg")
    canvas.setAttribute("width", "100%")
    canvas.setAttribute("height", "100%")
    canvas.style.border = "solid 2px #242930"
    
    main.appendChild(canvas)
    
    // Viewbox
    let bbox = canvas.getBoundingClientRect()
    const aspectRatio = bbox.width / bbox.height
    const height = 1000
    const width = height * aspectRatio
    const viewBox = { minX: 0, minY: 0, width: width, height: height }
    
    const viewBoxStr = [
        viewBox.minX, viewBox.minY, viewBox.width, viewBox.height
    ].join(" ")
    
    canvas.setAttribute("viewBox", viewBoxStr)
    
    const test = document.createElementNS(svgns, "image")
    test.setAttribute("x", viewBox.width / 2)
    prevX = viewBox.width / 2
    test.setAttribute("y", viewBox.height / 3)
    test.setAttribute("height", 512)
    test.setAttribute("width", 512)
    test.setAttribute("href", "test.png");
    canvas.appendChild(test)

    const circle = document.createElementNS(svgns, "circle")
    circle.setAttribute("cx", viewBox.width / 2)
    circle.setAttribute("cy", viewBox.height / 3)
    circle.setAttribute("r", 15)
    circle.setAttribute("fill", "#57cc8a")
    
    canvas.appendChild(circle)

    // Implementing the drag
    let clicked = false
    canvas.addEventListener("mousemove", (event) => {
        
        if (!clicked) {
            return
        }
    
        bbox = canvas.getBoundingClientRect()
    
        const x = (event.clientX - bbox.left) / bbox.width
        //const y = (event.clientY - bbox.top) / bbox.height

        velocity = (x - prevX) * 2000
        if (velocity > 90){ velocity = 90 }
        if (velocity < -90) { velocity = -90 }
        prevX = x
        console.log(velocity)
        test.setAttribute("transform", `rotate(${velocity}, ${x * viewBox.width}, ${viewBox.height / 3})`)        
        test.setAttribute("x", x * viewBox.width - 256)
        circle.setAttribute("cx", x * viewBox.width)

        //test.setAttribute("y", y * viewBox.height - 256)
    })
    
    // Click detection
    test.addEventListener("mousedown", (_) => { clicked = true })
    test.addEventListener("mouseup", (_) => { clicked = false })
    canvas.addEventListener("mouseleave", (_) => { clicked = false })
    
  </script>
  
</div>  
  
<head>
  Addi's Closet~
</head>
  
<body>
  
</body>

  
</html>
